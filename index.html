<!DOCTYPE html>
<html lang="ja"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no"><title>色で遊ぶ</title>
<style>*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;min-height:100vh;padding:12px;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%)}body.has-bg{background:url('backgrounds/background.jpg') center/cover fixed}.container{max-width:1000px;margin:0 auto}header{text-align:center;padding:10px 0 12px;color:#fff;display:flex;justify-content:space-between;align-items:center}.header-main{flex:1}header h1{font-size:1.1rem;font-weight:600;text-shadow:0 2px 10px rgba(0,0,0,.3)}header p{opacity:.9;font-size:.75rem;margin-top:2px}.lang-switch{background:rgba(255,255,255,.2);color:#fff;padding:6px 12px;border-radius:15px;text-decoration:none;font-size:.7rem}.sel-sum{position:sticky;top:0;z-index:100;background:#fff;border-radius:12px;padding:10px;margin-bottom:10px;box-shadow:0 4px 20px rgba(0,0,0,.15);display:flex;gap:8px;flex-wrap:wrap}.sel-pair{flex:1;min-width:140px;display:flex;flex-direction:column;gap:4px}.pair-hdr{display:flex;justify-content:space-between;align-items:center}.pair-ttl{font-size:.65rem;color:#888;font-weight:600}.copy-btn{padding:3px 8px;border-radius:10px;border:1px solid #ddd;background:#f5f5f5;color:#666;font-size:.6rem;cursor:pointer}.sel-items{display:flex;gap:4px}.sel-item{flex:1;display:flex;align-items:center;gap:5px;padding:5px 8px;border-radius:8px;cursor:pointer;border:2px solid #eee;background:#fafafa;transition:.2s}.sel-item.active{border-color:#667eea;background:rgba(102,126,234,.1)}.sel-dot{width:20px;height:20px;border-radius:50%;background:#ddd;background-size:cover;flex-shrink:0}.sel-dot.cA{box-shadow:0 0 0 2px #ff6b6b}.sel-dot.cB{box-shadow:0 0 0 2px #ffd93d}.sel-dot.cC{box-shadow:0 0 0 2px #6bcb77}.sel-dot.cD{box-shadow:0 0 0 2px #4d96ff}.sel-info{flex:1;min-width:0}.sel-lbl{font-size:.55rem;color:#888}.sel-nm{font-size:.65rem;color:#333;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.vtabs{display:flex;gap:6px;justify-content:center;margin-bottom:10px}.vtab{padding:7px 14px;border-radius:15px;background:rgba(255,255,255,.2);color:#fff;font-size:.75rem;cursor:pointer;border:none}.vtab.active{background:#fff;color:#667eea}.prev-sec{background:#fff;border-radius:14px;padding:10px;box-shadow:0 10px 40px rgba(0,0,0,.2)}.prev-c{width:100%;border-radius:10px;overflow:hidden;display:flex;align-items:center;justify-content:center}.prev-c.hidden{display:none!important}.tv{background:linear-gradient(180deg,#f0f0f0,#d8d8d8);aspect-ratio:2/1;max-height:220px;gap:20px}.oev{background:#1a1a2a;aspect-ratio:4/3;position:relative}.av{background:linear-gradient(180deg,#c8c8c8 0%,#fff 50%,#c8c8c8);aspect-ratio:4/3}#earCanvas,#angledCanvas{max-width:100%;max-height:100%;display:block}.ed{position:relative;width:80px;height:130px}.ball{position:absolute;border-radius:50%;cursor:pointer;background-size:cover;background-position:center}.ball::before{content:'';position:absolute;inset:0;border-radius:50%;background:radial-gradient(ellipse 50% 40% at 30% 25%,rgba(255,255,255,.7) 0%,transparent 60%),radial-gradient(ellipse 100% 60% at 50% 100%,rgba(0,0,0,.15) 0%,transparent 60%);pointer-events:none}.ball.sel{box-shadow:0 0 0 3px rgba(102,126,234,.6)}.fb{width:30px;height:30px;top:12px;left:50%;transform:translateX(-50%);z-index:2;background-color:#e0e0e0}.bb{width:48px;height:48px;bottom:15px;left:50%;transform:translateX(-50%);z-index:1;background-color:#d0d0d0}.pin{position:absolute;width:2px;height:22px;background:linear-gradient(to right,#999,#ccc,#999);top:42px;left:50%;transform:translateX(-50%);z-index:1}.plbl{position:absolute;bottom:-16px;left:50%;transform:translateX(-50%);font-size:.6rem;color:#666;font-weight:600}.ptog{display:flex;justify-content:center;gap:6px;margin:8px 0}.ptog.hidden{display:none}.ptog-btn{padding:5px 12px;border-radius:12px;border:1px solid #ddd;background:#f5f5f5;color:#666;font-size:.7rem;cursor:pointer}.ptog-btn.active{background:#667eea;border-color:#667eea;color:#fff}.tsec{margin-top:10px}.tsec h2{font-size:.8rem;color:#666;margin-bottom:8px;text-align:center}.tcar{display:block;overflow-x:auto;-webkit-overflow-scrolling:touch;padding:8px 0}.tcar-in{display:flex;gap:10px;padding:0 8px}.ti{flex-shrink:0;display:flex;flex-direction:column;align-items:center;cursor:pointer;padding:4px;border-radius:8px}.ti:active{transform:scale(.95)}.tc{width:55px;height:55px;border-radius:50%;background-size:115%;background-position:center}.ti.sA .tc{box-shadow:0 0 0 3px #ff6b6b}.ti.sB .tc{box-shadow:0 0 0 3px #ffd93d}.ti.sC .tc{box-shadow:0 0 0 3px #6bcb77}.ti.sD .tc{box-shadow:0 0 0 3px #4d96ff}.tn{font-size:.55rem;color:#666;margin-top:2px;max-width:55px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.rsec{background:#fff;border-radius:14px;padding:10px;margin-top:10px;box-shadow:0 10px 40px rgba(0,0,0,.2)}.rhdr{display:flex;justify-content:space-between;align-items:center;cursor:pointer;padding:4px 6px}.rhdr h2{font-size:.85rem;color:#333}.rhdr .ra{font-size:.8rem;color:#888;transition:transform .3s}.rhdr.coll .ra{transform:rotate(-90deg)}.rcnt{padding-top:8px}.rcnt.hidden{display:none}.re{display:flex;align-items:center;gap:10px;padding:8px;border-bottom:1px solid #eee}.re:last-child{border-bottom:none}.rn{font-size:1rem;font-weight:700;color:#667eea;width:28px;text-align:center;flex-shrink:0}.rp{border-radius:8px;flex-shrink:0}.ri{flex:1;min-width:0}.rtn{font-size:.65rem;color:#555;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.rc{font-size:.6rem;color:#999;flex-shrink:0}.remp{text-align:center;color:#aaa;font-size:.8rem;padding:20px}@media(min-width:600px){.sel-sum{flex-wrap:nowrap}.sel-pair{min-width:auto}.ed{width:100px;height:160px}.fb{width:38px;height:38px;top:15px}.bb{width:60px;height:60px;bottom:20px}.pin{height:28px;top:54px}.tc{width:50px;height:50px}}</style></head>
<body><div class="container">
<header><div class="header-main"><h1>色で遊ぶ</h1><p>A・B・C・Dのテクスチャを選択</p></div><a href="viewer-en.html" class="lang-switch">English</a></header>
<div class="sel-sum"><div class="sel-pair"><div class="pair-hdr"><span class="pair-ttl">ペア1</span></div><div class="sel-items"><div class="sel-item active" id="iA" onclick="sp('A')"><div class="sel-dot cA" id="dA"></div><div class="sel-info"><div class="sel-lbl">A (小)</div><div class="sel-nm" id="nA">-</div></div></div><div class="sel-item" id="iC" onclick="sp('C')"><div class="sel-dot cC" id="dC"></div><div class="sel-info"><div class="sel-lbl">C (大)</div><div class="sel-nm" id="nC">-</div></div></div></div></div>
<div class="sel-pair"><div class="pair-hdr"><span class="pair-ttl">ペア2</span><button class="copy-btn" onclick="cp12()">1→2コピー</button></div><div class="sel-items"><div class="sel-item" id="iB" onclick="sp('B')"><div class="sel-dot cB" id="dB"></div><div class="sel-info"><div class="sel-lbl">B (小)</div><div class="sel-nm" id="nB">-</div></div></div><div class="sel-item" id="iD" onclick="sp('D')"><div class="sel-dot cD" id="dD"></div><div class="sel-info"><div class="sel-lbl">D (大)</div><div class="sel-nm" id="nD">-</div></div></div></div></div></div>
<div class="vtabs"><button class="vtab active" data-view="template">テンプレート</button><button class="vtab" data-view="on-ear">着用イメージ</button><button class="vtab" data-view="angled">斜めビュー</button></div>
<div class="prev-sec"><div class="prev-c tv" id="tV"><div class="ed"><div class="ball fb" id="bA" onclick="sp('A')"></div><div class="pin"></div><div class="ball bb" id="bC" onclick="sp('C')"></div><div class="plbl">ペア1</div></div><div class="ed"><div class="ball fb" id="bB" onclick="sp('B')"></div><div class="pin"></div><div class="ball bb" id="bD" onclick="sp('D')"></div><div class="plbl">ペア2</div></div></div>
<div class="prev-c oev hidden" id="oV"><canvas id="earCanvas"></canvas></div>
<div class="prev-c av hidden" id="aV"><canvas id="angledCanvas"></canvas></div>
<div class="ptog" id="pTog"><button class="ptog-btn active" data-pair="1" onclick="sep(1)">ペア1 (A+C)</button><button class="ptog-btn" data-pair="2" onclick="sep(2)">ペア2 (B+D)</button></div>
<div class="tsec"><h2>テクスチャを選択</h2><div class="tcar"><div class="tcar-in" id="tCar"></div></div></div></div>
<div class="rsec" id="rSec"><div class="rhdr" id="rHdr" onclick="tgR()"><h2>人気の組み合わせ</h2><span class="ra" id="rA">▼</span></div><div class="rcnt" id="rCnt"><div class="remp" id="rEmp">読み込み中...</div></div></div></div>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script><script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script>
const C={"textures":[{"id":"1769519654738","name":"#1","image":"textures/-1.webp"},{"id":"1769519676496","name":"#2","image":"textures/-2.webp"},{"id":"1769519713744","name":"#3","image":"textures/-3.webp"},{"id":"1769519737002","name":"#4","image":"textures/-4.webp"},{"id":"1769519761612","name":"#5","image":"textures/-5.webp"},{"id":"1769519809262","name":"#6","image":"textures/-6.webp"},{"id":"1769521589941","name":"#7","image":"textures/-7.webp"},{"id":"1769523745999","name":"#8","image":"textures/-8.webp"},{"id":"1769523772226","name":"#9","image":"textures/-9.webp"},{"id":"1769524277509","name":"#10","image":"textures/-10.webp"},{"id":"1769770084012","name":"#11","image":"textures/-11.webp"},{"id":"1769770332497","name":"#12","image":"textures/-12.webp"},{"id":"1769771739367","name":"#13","image":"textures/-13.webp"},{"id":"1769771991709","name":"#14","image":"textures/-14.webp"},{"id":"1769772439613","name":"#15","image":"textures/-15.webp"},{"id":"1769781278569","name":"#16","image":"textures/-16.webp"},{"id":"1769782249303","name":"#17","image":"textures/-17.webp"},{"id":"1769782502525","name":"#18","image":"textures/-18.webp"},{"id":"1769783309138","name":"#19 (クリア)","image":"textures/-19------.webp"},{"id":"1769783613027","name":"#20","image":"textures/-20.webp"},{"id":"1769783870929","name":"#21","image":"textures/-21.webp"},{"id":"1769784231970","name":"#22","image":"textures/-22.webp"},{"id":"1769784603015","name":"#23","image":"textures/-23.webp"},{"id":"1769784861011","name":"#24","image":"textures/-24.webp"},{"id":"1769785261946","name":"#25","image":"textures/-25.webp"},{"id":"1769785854068","name":"#26","image":"textures/-26.webp"},{"id":"1769786092979","name":"#27","image":"textures/-27.webp"},{"id":"1769786267326","name":"#28","image":"textures/-28.webp"},{"id":"1769786479659","name":"#29","image":"textures/-29.webp"},{"id":"1769787708357","name":"#30","image":"textures/-30.webp"},{"id":"1769787979230","name":"#31","image":"textures/-31.webp"},{"id":"1769788189013","name":"#32","image":"textures/-32.webp"},{"id":"1769788465703","name":"#33","image":"textures/-33.webp"},{"id":"1769789034036","name":"#34","image":"textures/-34.webp"},{"id":"1769790238703","name":"#35","image":"textures/-35.webp"},{"id":"1769793630583","name":"#36","image":"textures/-36.webp"},{"id":"1769828761504","name":"#37","image":"textures/-37.webp"},{"id":"1769828982559","name":"#38","image":"textures/-38.webp"},{"id":"1769829407833","name":"#39","image":"textures/-39.webp"},{"id":"1769831015693","name":"#40","image":"textures/-40.webp"},{"id":"1769831269423","name":"#41","image":"textures/-41.webp"},{"id":"1769832389395","name":"#42","image":"textures/-42.webp"},{"id":"1769832590214","name":"#43","image":"textures/-43.webp"},{"id":"1769832986488","name":"#44","image":"textures/-44.webp"},{"id":"1769834217715","name":"#45","image":"textures/-45.webp"},{"id":"1769834382662","name":"#46","image":"textures/-46.webp"},{"id":"1769835794022","name":"#47","image":"textures/-47.webp"},{"id":"1769836329707","name":"#48","image":"textures/-48.webp"}],"modelImage":"images/model_base.png","earImage":"images/ear_overlay.png","backgroundImage":"backgrounds/background.jpg","position":{"frontX":37.3636427815037,"frontY":82.67843981709068},"backOffset":{"x":6,"y":7},"ballSizeScale":{"front":150,"back":140},"imageTransform":{"model":{"scale":100,"offsetX":0,"offsetY":0},"ear":{"scale":100,"offsetX":0,"offsetY":0}},"textureDisplaySize":50,"earEdgeOverlap":8,"firebaseConfig":{"apiKey":"AIzaSyBdcxpkBoDjDR0DSrIazxQGiNQp0kj-mWg","projectId":"earring-customizer","databaseUrl":"https://earring-customizer-default-rtdb.asia-southeast1.firebasedatabase.app"},"rankTopN":10};let sel='A',ti={A:null,B:null,C:null,D:null},tm={A:null,B:null,C:null,D:null},cep=1,mI=null,eI=null,eC,eCx,aC,aCx,iL=0,iTL=0,tracked=new Set();
function init(){if(C.backgroundImage){const i=new Image();i.onload=()=>document.body.classList.add('has-bg');i.src=C.backgroundImage;}rT();sTabs();iEC();iAC();uPTV();iFb();}
let db=null;function iFb(){if(typeof firebase==='undefined'){document.getElementById('rEmp').textContent='Firebase not available';return;}try{firebase.initializeApp({apiKey:C.firebaseConfig.apiKey,projectId:C.firebaseConfig.projectId,databaseURL:C.firebaseConfig.databaseUrl});db=firebase.database();lR();}catch(e){console.error(e);document.getElementById('rEmp').textContent='Connection error';}}
function trk(si,bi,sn,bn){if(!db||!si||!bi)return;const k=si+'_'+bi;if(tracked.has(k))return;tracked.add(k);db.ref('pairs/'+k).transaction(c=>c?{...c,count:(c.count||0)+1}:{count:1,smallId:si,bigId:bi,smallName:sn,bigName:bn});}
function chk(){if(ti.A&&ti.C){const a=C.textures.find(x=>x.id===ti.A),c=C.textures.find(x=>x.id===ti.C);if(a&&c)trk(ti.A,ti.C,a.name,c.name);}if(ti.B&&ti.D){const b=C.textures.find(x=>x.id===ti.B),d=C.textures.find(x=>x.id===ti.D);if(b&&d)trk(ti.B,ti.D,b.name,d.name);}}
function lR(){if(!db)return;db.ref('pairs').orderByChild('count').limitToLast(10).on('value',s=>{const e=[];s.forEach(c=>e.push(c.val()));e.reverse();rnR(e);});}
function rnR(e){const c=document.getElementById('rCnt');if(!e||!e.length){c.innerHTML='<div class="remp">まだデータがありません</div>';return;}c.innerHTML='';e.forEach((en,i)=>{const d=document.createElement('div');d.className='re';const cv=document.createElement('canvas');cv.width=120;cv.height=80;cv.className='rp';cv.style.width='60px';cv.style.height='40px';d.innerHTML='<div class="rn">#'+(i+1)+'</div>';d.appendChild(cv);const inf=document.createElement('div');inf.className='ri';inf.innerHTML='<div class="rtn">小: '+(en.smallName||'?')+'</div><div class="rtn">大: '+(en.bigName||'?')+'</div>';d.appendChild(inf);d.innerHTML+='<div class="rc">'+en.count+' 回</div>';c.appendChild(d);drP(cv,en);});}
function drP(cv,en){const cx=cv.getContext('2d'),w=cv.width,h=cv.height;cx.fillStyle='#f0f0f0';cx.fillRect(0,0,w,h);const st=C.textures.find(x=>x.id===en.smallId),bt=C.textures.find(x=>x.id===en.bigId);let si=null,bi=null,ld=0;const td=()=>{if(ld<2)return;const bR=Math.min(w,h)*.3,fR=bR/1.6,a=Math.PI/6,dist=(fR+bR)*.8;const sx=w*.5-Math.cos(a)*dist*.4,sy=h*.5+Math.sin(a)*dist*.5,bx=w*.5+Math.cos(a)*dist*.4,by=h*.5-Math.sin(a)*dist*.5;cx.beginPath();cx.moveTo(sx,sy);cx.lineTo(bx,by);cx.strokeStyle='#bbb';cx.lineWidth=1;cx.stroke();dmb(cx,bx,by,bR,bi);dmb(cx,sx,sy,fR,si);};if(st){const im=new Image();im.onload=()=>{si=im;ld++;td();};im.onerror=()=>{ld++;td();};im.src=st.image;}else ld++;if(bt){const im=new Image();im.onload=()=>{bi=im;ld++;td();};im.onerror=()=>{ld++;td();};im.src=bt.image;}else ld++;if(ld>=2)td();}
function dmb(cx,x,y,r,t){cx.save();cx.beginPath();cx.arc(x,y,r,0,Math.PI*2);if(t){cx.save();cx.clip();cx.drawImage(t,x-r,y-r,r*2,r*2);cx.restore();}else{cx.fillStyle='#ddd';cx.fill();}const hl=cx.createRadialGradient(x-r*.3,y-r*.3,0,x-r*.3,y-r*.3,r);hl.addColorStop(0,'rgba(255,255,255,.5)');hl.addColorStop(1,'transparent');cx.beginPath();cx.arc(x,y,r,0,Math.PI*2);cx.fillStyle=hl;cx.fill();cx.restore();}
function tgR(){const c=document.getElementById('rCnt'),h=document.getElementById('rHdr'),a=document.getElementById('rA'),ih=c.classList.contains('hidden');c.classList.toggle('hidden');h.classList.toggle('coll',!ih);a.textContent=ih?'▼':'▶';}
function rT(){const c=document.getElementById('tCar');c.innerHTML='';C.textures.forEach(t=>{const i=document.createElement('div');i.className='ti';i.setAttribute('data-id',t.id);i.innerHTML='<div class="tc" style="background-image:url('+t.image+')"></div><div class="tn">'+t.name+'</div>';i.onclick=()=>aT(t.id,t.image,t.name);c.appendChild(i);});}
function sTabs(){document.querySelectorAll('.vtab').forEach(tab=>{tab.addEventListener('click',()=>{document.querySelectorAll('.vtab').forEach(t=>t.classList.remove('active'));tab.classList.add('active');const v=tab.dataset.view;document.getElementById('tV').classList.toggle('hidden',v!=='template');document.getElementById('oV').classList.toggle('hidden',v!=='on-ear');document.getElementById('aV').classList.toggle('hidden',v!=='angled');document.getElementById('pTog').classList.toggle('hidden',v==='template'||v==='angled');if(v==='on-ear')setTimeout(()=>{rEC();rnEC();},50);if(v==='angled')setTimeout(()=>{rAC();rnAC();},50);});});}
function sp(p){sel=p;['A','B','C','D'].forEach(x=>{const el=document.getElementById('i'+x);if(el)el.classList.toggle('active',x===p);const b=document.getElementById('b'+x);if(b)b.classList.toggle('sel',x===p);});}
function cp12(){ti.B=ti.A;ti.D=ti.C;['B','D'].forEach(p=>{const s=p==='B'?'A':'C';if(ti[s]){const t=C.textures.find(x=>x.id===ti[s]);if(t){const im=new Image();im.onload=()=>{tm[p]=im;rnEC();rnAC();};im.src=t.image;document.getElementById('n'+p).textContent=t.name;}}else{tm[p]=null;document.getElementById('n'+p).textContent='-';}});uP();uPTV();chk();}
function api(){return ti.A===ti.B&&ti.C===ti.D;}
function uPTV(){document.getElementById('pTog').classList.toggle('hidden',api());}
function sep(p){cep=p;document.querySelectorAll('.ptog-btn').forEach(b=>b.classList.toggle('active',+b.dataset.pair===p));rnEC();}
function aT(id,img,nm){ti[sel]=id;const im=new Image();im.onload=()=>{tm[sel]=im;uP();rnEC();rnAC();uPTV();chk();};im.src=img;document.getElementById('n'+sel).textContent=nm;}
function uP(){['A','B','C','D'].forEach(p=>{const t=C.textures.find(x=>x.id===ti[p]),u=t?'url('+t.image+')':'none';const b=document.getElementById('b'+p);if(b)b.style.backgroundImage=u;document.getElementById('d'+p).style.backgroundImage=u;});document.querySelectorAll('.ti').forEach(i=>{const id=i.getAttribute('data-id');i.classList.remove('sA','sB','sC','sD');['A','B','C','D'].forEach(p=>{if(ti[p]===id)i.classList.add('s'+p);});});}
function iEC(){eC=document.getElementById('earCanvas');eCx=eC.getContext('2d');if(C.modelImage)iTL++;if(C.earImage)iTL++;if(C.modelImage){mI=new Image();mI.onload=oIL;mI.src=C.modelImage;}if(C.earImage){eI=new Image();eI.onload=oIL;eI.src=C.earImage;}}
function oIL(){iL++;if(iL>=iTL){rEC();rnEC();}}
function rEC(){const b=mI||eI;if(!b)return;const c=document.getElementById('oV'),w=c.clientWidth||400,h=c.clientHeight||300,ir=b.width/b.height,cr=w/h;let dw,dh;if(ir>cr){dw=w;dh=w/ir;}else{dh=h;dw=h*ir;}eC.width=dw;eC.height=dh;}
function gID(w,h,tr){const sc=tr.scale/100,dw=w*sc,dh=h*sc,ox=(tr.offsetX/100)*w,oy=(tr.offsetY/100)*h;return{x:(w-dw)/2+ox,y:(h-dh)/2+oy,w:dw,h:dh};}
function rnEC(){if(!eCx||(!mI&&!eI))return;const w=eC.width,h=eC.height;eCx.clearRect(0,0,w,h);const pos=C.position,off=C.backOffset||{x:0,y:6},it=C.imageTransform||{model:{scale:100,offsetX:0,offsetY:0},ear:{scale:100,offsetX:0,offsetY:0}},bs=C.ballSizeScale||{front:100,back:100};const fx=(pos.frontX/100)*w,fy=(pos.frontY/100)*h,bx=fx+(off.x/100)*w,by=fy+(off.y/100)*h;const fR=Math.min(w,h)*.041*(bs.front/100),bR=Math.min(w,h)*.065*(bs.back/100);const fT=cep===1?tm.A:tm.B,bT=cep===1?tm.C:tm.D;const bg=eCx.createRadialGradient(w/2,h/2,0,w/2,h/2,Math.max(w,h));bg.addColorStop(0,'#2a2a3a');bg.addColorStop(1,'#1a1a2a');eCx.fillStyle=bg;eCx.fillRect(0,0,w,h);if(mI){const p=gID(w,h,it.model);eCx.drawImage(mI,p.x,p.y,p.w,p.h);}dB(eCx,bx,by,bR,bT,'back');if(eI){const ol=C.earEdgeOverlap||0,p=gID(w,h,it.ear);eCx.drawImage(eI,p.x-ol,p.y-ol,p.w+ol*2,p.h+ol*2);}dB(eCx,fx,fy,fR,fT,'front');}
function dB(cx,x,y,r,t,tp){cx.save();cx.translate(x,y);if(tp==='back')cx.scale(1,.95);cx.shadowColor='rgba(0,0,0,.4)';cx.shadowBlur=tp==='front'?8:12;cx.shadowOffsetX=cx.shadowOffsetY=tp==='front'?3:4;cx.beginPath();cx.arc(0,0,r,0,Math.PI*2);if(t){cx.save();cx.clip();cx.drawImage(t,-r,-r,r*2,r*2);cx.restore();}else{cx.fillStyle=tp==='front'?'#e0e0e0':'#d0d0d0';cx.fill();}cx.shadowColor='transparent';const hl=cx.createRadialGradient(-r*.35,-r*.35,0,-r*.35,-r*.35,r*1.2);hl.addColorStop(0,'rgba(255,255,255,.6)');hl.addColorStop(.3,'rgba(255,255,255,.2)');hl.addColorStop(1,'transparent');cx.beginPath();cx.arc(0,0,r,0,Math.PI*2);cx.fillStyle=hl;cx.fill();cx.restore();}
function iAC(){aC=document.getElementById('angledCanvas');aCx=aC.getContext('2d');rAC();rnAC();}
function rAC(){const c=document.getElementById('aV'),dw=c.clientWidth||400,dh=c.clientHeight||300;aC.width=dw*2;aC.height=dh*2;aC.style.width=dw+'px';aC.style.height=dh+'px';}
function rnAC(){if(!aCx)return;const w=aC.width,h=aC.height;aCx.clearRect(0,0,w,h);const bg=aCx.createLinearGradient(0,0,0,h);bg.addColorStop(0,'#c8c8c8');bg.addColorStop(.3,'#f5f5f5');bg.addColorStop(.5,'#fff');bg.addColorStop(.7,'#f5f5f5');bg.addColorStop(1,'#c8c8c8');aCx.fillStyle=bg;aCx.fillRect(0,0,w,h);const id=api();if(id){const bR=Math.min(w,h)*.12,fR=bR/1.6,a=Math.PI/6,d=(fR+bR)*.8,yo=Math.sin(a)*d*.5,bby=h*.52;dAE(w*.3,bby+yo,fR,bR,'front',tm.A,tm.C);dAE(w*.7,bby-yo,fR,bR,'back',tm.A,tm.C);}else{const bR=Math.min(w,h)*.09,fR=bR/1.6,a=Math.PI/6,d=(fR+bR)*.8,yo=Math.sin(a)*d*.5,p1=h*.35,p2=h*.68;dAE(w*.3,p1+yo,fR,bR,'front',tm.A,tm.C);dAE(w*.7,p1-yo,fR,bR,'back',tm.A,tm.C);dAE(w*.3,p2+yo,fR,bR,'front',tm.B,tm.D);dAE(w*.7,p2-yo,fR,bR,'back',tm.B,tm.D);aCx.font='bold '+(w*.025)+'px sans-serif';aCx.fillStyle='#888';aCx.textAlign='center';aCx.fillText('ペア1',w*.5,p1-bR*1.5);aCx.fillText('ペア2',w*.5,p2-bR*1.5);}}
function dAE(cx,cy,fR,bR,vt,fT,bT){const a=Math.PI/6,d=(fR+bR)*.8,fbx=cx-Math.cos(a)*d*.4,fby=cy+Math.sin(a)*d*.5,bbx=cx+Math.cos(a)*d*.4,bby=cy-Math.sin(a)*d*.5;let sx,sy,gx,gy,dsl;if(vt==='front'){sx=fbx;sy=fby;gx=bbx;gy=bby;dsl=true;}else{gx=fbx;gy=fby;sx=bbx;sy=bby;dsl=false;}aCx.save();aCx.beginPath();aCx.moveTo(sx,sy);aCx.lineTo(gx,gy);aCx.strokeStyle='#bbb';aCx.lineWidth=2;aCx.stroke();aCx.restore();if(dsl){dAB(gx,gy,bR,bT);dAB(sx,sy,fR,fT);}else{dAB(sx,sy,fR,fT);dAB(gx,gy,bR,bT);}}
function dAB(x,y,r,t){aCx.save();aCx.shadowColor='rgba(0,0,0,.25)';aCx.shadowBlur=r*.4;aCx.shadowOffsetX=aCx.shadowOffsetY=r*.15;aCx.beginPath();aCx.arc(x,y,r,0,Math.PI*2);if(t){aCx.save();aCx.clip();aCx.drawImage(t,x-r,y-r,r*2,r*2);aCx.restore();}else{aCx.fillStyle='#e0e0e0';aCx.fill();}aCx.shadowColor='transparent';const hl=aCx.createRadialGradient(x-r*.35,y-r*.35,0,x-r*.35,y-r*.35,r*1.2);hl.addColorStop(0,'rgba(255,255,255,.7)');hl.addColorStop(.3,'rgba(255,255,255,.3)');hl.addColorStop(1,'transparent');aCx.beginPath();aCx.arc(x,y,r,0,Math.PI*2);aCx.fillStyle=hl;aCx.fill();aCx.restore();}
document.addEventListener('DOMContentLoaded',init);
</script></body></html>